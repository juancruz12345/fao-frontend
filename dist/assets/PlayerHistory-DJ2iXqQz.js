import{j as e,a6 as P,a7 as V,r as o,V as G,C as z,T as M,ab as q,ac as A,ad as K,ae as O}from"./index-9bMVTCwX.js";import{T as Q}from"./TournamentContext-BMmpxaMy.js";import{F as i,T as W}from"./ToastComponent-D3yLYERk.js";import{C as a}from"./Card-BHA5EGH-.js";import{T as X}from"./Table-DXOjfKuV.js";import{R as w,C as c}from"./Row-DHyPlMXB.js";import{B as g}from"./Button-mQ-mTWkK.js";import{B as $}from"./Badge-BqfGFKAQ.js";import"./warning-CflMChQJ.js";import"./useWillUnmount-lf6GNjCN.js";function J(){var b,C;const{id:x}=P(),v=V(),{players:T}=v.state||{},t=T.find(s=>s.id===parseInt(x)).name,[d,u]=o.useState(""),[h,p]=o.useState(""),[f,m]=o.useState([]),[_,N]=o.useState(!1),{data:n=[],isLoading:L,isError:S}=G({queryKey:["player_history",x],queryFn:async()=>{console.log("Fetching historial");const s=await fetch(`https://fao-backend.onrender.com/player/${x}/matches`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!s.ok)throw new Error("Error al cargar la página");return s.json()},staleTime:1e3*60*20,cacheTime:1e3*60*30,refetchOnWindowFocus:!1}),B=()=>{if(!n.matches)return;const s=n.matches.filter(r=>(d===""||r.player1_name.toLowerCase().includes(d.toLowerCase())||r.player2_name.toLowerCase().includes(d.toLowerCase()))&&(h===""||r.tournament_name.toLowerCase().includes(h.toLowerCase())));s.length>0?m(s):N(!0),console.log(s)},E=()=>{u(""),p(""),m([])};o.useEffect(()=>{var s;((s=n==null?void 0:n.matches)==null?void 0:s.length)>0&&R()},[n]);const[k,j]=o.useState(0),[I,D]=o.useState(0),[F,y]=o.useState(0);function R(){var s;if(((s=n==null?void 0:n.matches)==null?void 0:s.length)>0)for(const r of n.matches)(r==null?void 0:r.result)==="1-0"&&(r==null?void 0:r.player1_name)===t?j(l=>l+1):(r==null?void 0:r.result)==="0-1"&&(r==null?void 0:r.player2_name)===t?j(l=>l+1):(r==null?void 0:r.player1_name)===t&&(r==null?void 0:r.player2_name)==="LIBRE"||(r==null?void 0:r.player2_name)===t&&(r==null?void 0:r.player1_name)==="LIBRE"?j(l=>l+1):(r==null?void 0:r.result)==="1-0"&&(r==null?void 0:r.player2_name)===t?y(l=>l+1):(r==null?void 0:r.result)==="0-1"&&(r==null?void 0:r.player1_name)===t?y(l=>l+1):(r==null?void 0:r.result)==="1/2-1/2"&&D(l=>l+1)}return S?e.jsx("div",{className:"text-center text-danger",children:"Error al cargar el historial del jugador"}):e.jsxs("div",{children:[e.jsxs(z,{className:"py-5",id:"player-history-container",children:[e.jsx("h1",{className:"mb-4",children:t}),L?e.jsx(M,{msg:"Cargando historial de jugador"}):e.jsx("div",{children:Array.isArray(n==null?void 0:n.matches)&&((b=n==null?void 0:n.matches)==null?void 0:b.length)>0?e.jsxs("div",{children:[e.jsxs(a,{className:"mb-4",children:[e.jsx(a.Header,{children:e.jsx(a.Title,{children:"Estadísticas"})}),e.jsx(a.Body,{children:e.jsxs(X,{striped:!0,bordered:!0,hover:!0,responsive:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Victorias"}),e.jsx("th",{children:"Empates"}),e.jsx("th",{children:"Derrotas"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:k}),e.jsx("td",{children:I}),e.jsx("td",{children:F})]})})]})})]}),e.jsx(a,{className:"mb-4",children:e.jsx(a.Body,{children:e.jsxs(w,{className:"g-3",children:[e.jsx(c,{xs:12,sm:6,md:4,children:e.jsxs(i.Group,{children:[e.jsx(i.Label,{children:"Buscar por jugador"}),e.jsx(i.Control,{type:"text",placeholder:"Nombre del jugador",value:d,onChange:s=>u(s.target.value)})]})}),e.jsx(c,{xs:12,sm:6,md:4,children:e.jsxs(i.Group,{children:[e.jsx(i.Label,{children:"Buscar por torneo"}),e.jsx(i.Control,{type:"text",placeholder:"Nombre del torneo",value:h,onChange:s=>p(s.target.value)})]})}),e.jsx(c,{xs:12,md:4,className:"d-flex align-items-end",children:e.jsxs("div",{className:"d-flex gap-2 flex-grow-1",children:[e.jsxs(g,{variant:"primary",onClick:B,className:"flex-grow-1",children:[e.jsx(q,{size:20,className:"me-2"}),"Buscar"]}),e.jsxs(g,{variant:"outline-secondary",onClick:E,className:"flex-grow-1",children:[e.jsx(A,{size:20,className:"me-2"}),"Limpiar"]})]})})]})})}),e.jsx(w,{xs:1,md:2,lg:3,className:"g-4",children:(C=f.length>0?f:n==null?void 0:n.matches)==null?void 0:C.map(s=>e.jsx(c,{children:e.jsxs(a,{className:"h-100",children:[e.jsxs(a.Header,{children:[e.jsxs(a.Title,{className:"h5 mb-0",children:[e.jsx("strong",{children:"Torneo:"})," ",s==null?void 0:s.tournament_name]}),e.jsxs(a.Subtitle,{className:"mt-1",children:[e.jsx("strong",{children:"Ronda "}),s==null?void 0:s.round_number]})]}),e.jsx(a.Body,{children:e.jsxs("div",{className:"match-result",children:[e.jsx("div",{className:"player-name",children:e.jsx("span",{children:s==null?void 0:s.player1_name})}),e.jsx($,{bg:"secondary",children:s==null?void 0:s.result}),e.jsx("div",{className:"player-name",children:e.jsx("span",{children:s==null?void 0:s.player2_name})})]})}),e.jsx(a.Footer,{children:e.jsxs("div",{className:"match-links",children:[(s==null?void 0:s.link)&&e.jsxs("a",{href:s.link,target:"_blank",rel:"noopener noreferrer",className:"btn btn-outline-secondary btn-sm",children:["Ver partida ",e.jsx(K,{})]}),(s==null?void 0:s.pgn)&&e.jsxs("a",{href:s==null?void 0:s.pgn,download:!0,className:"btn btn-outline-primary btn-sm",onClick:r=>{r.preventDefault(),window.open(s.pgn,"_blank")},children:["Descargar PGN ",e.jsx(O,{size:16})]})]})})]})},s.match_id))})]}):e.jsx("h2",{className:"h2-no-historial",children:"No hay historial del jugador seleccionado"})})]}),e.jsx(W,{show:_,setShow:N,msg:"No se encuentro ninguna partida."})]})}function te(){return e.jsx(Q,{children:e.jsx(J,{})})}export{J as PlayerHistoryContent,te as default};
