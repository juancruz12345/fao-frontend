import{u as B,r as o,V as E,j as e,T as F,C as b,U as R,ab as G,ac as M,ad as P,ae as A}from"./index-BHeBwaQY.js";import{F as n,T as I}from"./ToastComponent-wfRgfQl_.js";import{R as x,C as i}from"./Row-cu-65cpA.js";import{C as L}from"./Card-CpCgghwF.js";import{B as S}from"./Button-o09q16N0.js";import{T as q}from"./Table-BprD6uSp.js";import"./warning-ByQxE_mr.js";import"./useWillUnmount-km8qQ_co.js";function X(){const{players:j}=B(),v=new Map(j.map(s=>[s.id,s.name])),l=s=>v.get(s)||"Unknown Player",u=s=>j.find(r=>r.id===s)||{rating:"N/A"},[t,p]=o.useState(""),[d,g]=o.useState(""),[c,h]=o.useState(""),[f,y]=o.useState([]),[_,w]=o.useState(!1),k=()=>{if(!(a!=null&&a.length)>0)return;const s=a.filter(r=>(t===""||l(r.player1_id).toLowerCase().includes(t.toLowerCase())||l(r.player2_id).toLowerCase().includes(t.toLowerCase()))&&(d===""||r.tournament_name.toLowerCase().includes(d.toLowerCase()))&&(c===""||new Date(r==null?void 0:r.tournament_start_date).toLocaleDateString().includes(c)));s.length>0?y(s):w(!0)},T=()=>{p(""),g(""),h(""),y([])},{data:a=[],isLoading:m,isError:C}=E({queryKey:["allMatchesDataBase"],queryFn:async()=>{console.log("Fetching database");const s=await fetch("https://fao-backend.onrender.com/matches",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!s.ok)throw new Error("Error al cargar la pÃ¡gina");return s.json()},staleTime:1e3*60*20,cacheTime:1e3*60*30,refetchOnWindowFocus:!1});return console.log(a),m?e.jsx(F,{msg:"Cargando base de datos"}):C?e.jsx(b,{className:"py-5",children:e.jsxs(R,{variant:"danger",children:["Error: ",C]})}):e.jsxs("div",{children:[e.jsxs(b,{id:"database-container",children:[e.jsx("h1",{className:"title",children:"Base de datos"}),e.jsx(x,{children:e.jsx(L,{className:"mb-4",children:e.jsx(L.Body,{children:e.jsxs(x,{className:"g-3",children:[e.jsx(i,{xs:12,sm:6,md:4,children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{children:"Buscar por jugador"}),e.jsx(n.Control,{type:"text",placeholder:"Nombre del jugador",value:t,onChange:s=>p(s.target.value)})]})}),e.jsx(i,{xs:12,sm:6,md:4,children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{children:"Buscar por torneo"}),e.jsx(n.Control,{type:"text",placeholder:"Nombre del torneo",value:d,onChange:s=>g(s.target.value)})]})}),e.jsx(i,{xs:12,sm:6,md:4,children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{children:"Buscar por fecha"}),e.jsx(n.Control,{type:"text",placeholder:"Fecha del torneo",value:c,onChange:s=>h(s.target.value)})]})}),e.jsx(i,{xs:12,md:4,className:"d-flex align-items-end",children:e.jsxs("div",{className:"d-flex gap-2 flex-grow-1",children:[e.jsxs(S,{variant:"primary",onClick:k,className:"flex-grow-1",children:[e.jsx(G,{size:20,className:"me-2"}),"Buscar"]}),e.jsxs(S,{variant:"outline-secondary",onClick:T,className:"flex-grow-1",children:[e.jsx(M,{size:20,className:"me-2"}),"Limpiar"]})]})})]})})})}),e.jsx(x,{children:e.jsxs(q,{striped:!0,bordered:!0,hover:!0,responsive:!0,className:"database-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Jugador de blancas"}),e.jsx("th",{children:"Rating"}),e.jsx("th",{children:"Jugador de negras"}),e.jsx("th",{children:"Rating"}),e.jsx("th",{children:"Torneo"}),e.jsx("th",{children:"Fecha"}),e.jsx("th",{children:"Resultado"}),e.jsx("th",{children:"Link"}),e.jsx("th",{children:"PGN"})]})}),e.jsx("tbody",{children:(f.length>0?f:a).map(s=>{var r,N;return e.jsxs("tr",{children:[e.jsx("td",{children:l(s==null?void 0:s.player1_id)}),e.jsx("td",{children:((r=u(s==null?void 0:s.player1_id))==null?void 0:r.rating)||"N/A"}),e.jsx("td",{children:l(s==null?void 0:s.player2_id)}),e.jsx("td",{children:((N=u(s.player2_id))==null?void 0:N.rating)||"N/A"}),e.jsx("td",{children:s==null?void 0:s.tournament_name}),e.jsx("td",{children:new Date(s==null?void 0:s.tournament_start_date).toLocaleDateString()}),e.jsx("td",{children:s==null?void 0:s.result}),e.jsx("td",{children:(s==null?void 0:s.link)&&e.jsxs("a",{href:s==null?void 0:s.link,children:["Link ",e.jsx(P,{})]})}),e.jsx("td",{children:(s==null?void 0:s.pgn)&&e.jsxs("a",{href:s==null?void 0:s.pgn,download:!0,className:"btn btn-outline-primary btn-sm",onClick:D=>{D.preventDefault(),window.open(s.pgn,"_blank")},children:["Descargar ",e.jsx(A,{})]})})]},s==null?void 0:s.id)})})]})})]}),e.jsx(I,{show:_,setShow:w,msg:"No se encuentro ninguna partida."})]})}export{X as default};
