import{r as d,y as C,j as e,a5 as q,z as A,a6 as z,a3 as G,M as J,O as H,C as P,a7 as Q,T as U,a8 as W}from"./index-BKcmjB81.js";import{R as X,C as K}from"./Row-CY8um4bv.js";import{C as y}from"./Card-Kh-DD9Gn.js";import{B as Y}from"./Badge-CbdyvGZ7.js";import{T as Z}from"./Table-LajqTO9z.js";function M(a,n){return Array.isArray(a)?a.includes(n):a===n}const w=d.createContext({});w.displayName="AccordionContext";const I=d.forwardRef(({as:a="div",bsPrefix:n,className:l,children:m,eventKey:x,...s},c)=>{const{activeEventKey:f}=d.useContext(w);return n=C(n,"accordion-collapse"),e.jsx(q,{ref:c,in:M(f,x),...s,className:A(l,n),children:e.jsx(a,{children:d.Children.only(m)})})});I.displayName="AccordionCollapse";const R=d.createContext({eventKey:""});R.displayName="AccordionItemContext";const k=d.forwardRef(({as:a="div",bsPrefix:n,className:l,onEnter:m,onEntering:x,onEntered:s,onExit:c,onExiting:f,onExited:p,...g},N)=>{n=C(n,"accordion-body");const{eventKey:E}=d.useContext(R);return e.jsx(I,{eventKey:E,onEnter:m,onEntering:x,onEntered:s,onExit:c,onExiting:f,onExited:p,children:e.jsx(a,{ref:N,...g,className:A(l,n)})})});k.displayName="AccordionBody";function _(a,n){const{activeEventKey:l,onSelect:m,alwaysOpen:x}=d.useContext(w);return s=>{let c=a===l?null:a;x&&(Array.isArray(l)?l.includes(a)?c=l.filter(f=>f!==a):c=[...l,a]:c=[a]),m==null||m(c,s),n==null||n(s)}}const L=d.forwardRef(({as:a="button",bsPrefix:n,className:l,onClick:m,...x},s)=>{n=C(n,"accordion-button");const{eventKey:c}=d.useContext(R),f=_(c,m),{activeEventKey:p}=d.useContext(w);return a==="button"&&(x.type="button"),e.jsx(a,{ref:s,onClick:f,...x,"aria-expanded":Array.isArray(p)?p.includes(c):c===p,className:A(l,n,!M(p,c)&&"collapsed")})});L.displayName="AccordionButton";const D=d.forwardRef(({as:a="h2","aria-controls":n,bsPrefix:l,className:m,children:x,onClick:s,...c},f)=>(l=C(l,"accordion-header"),e.jsx(a,{ref:f,...c,className:A(m,l),children:e.jsx(L,{onClick:s,"aria-controls":n,children:x})})));D.displayName="AccordionHeader";const F=d.forwardRef(({as:a="div",bsPrefix:n,className:l,eventKey:m,...x},s)=>{n=C(n,"accordion-item");const c=d.useMemo(()=>({eventKey:m}),[m]);return e.jsx(R.Provider,{value:c,children:e.jsx(a,{ref:s,...x,className:A(l,n)})})});F.displayName="AccordionItem";const V=d.forwardRef((a,n)=>{const{as:l="div",activeKey:m,bsPrefix:x,className:s,onSelect:c,flush:f,alwaysOpen:p,...g}=z(a,{activeKey:"onSelect"}),N=C(x,"accordion"),E=d.useMemo(()=>({activeEventKey:m,onSelect:c,alwaysOpen:p}),[m,c,p]);return e.jsx(w.Provider,{value:E,children:e.jsx(l,{ref:n,...g,className:A(s,N,f&&`${N}-flush`)})})});V.displayName="Accordion";const b=Object.assign(V,{Button:L,Collapse:I,Item:F,Header:D,Body:k});function oe(){var p,g,N,E,S,T,O;const{id:a}=G(),[n,l]=d.useState({}),m=async o=>{try{console.log("Fetching details");const r=await fetch(`https://lichess.org/api/broadcast/${o}`);if(!r.ok)throw new Error("Error al obtener el broadcast");const u=await r.json();if(!u.rounds||u.rounds.length===0)throw new Error("El broadcast no tiene rondas disponibles.");const j=u.rounds.map(i=>{var v;const B=`https://lichess.org/api/broadcast/${(v=u==null?void 0:u.tour)==null?void 0:v.slug}/${i==null?void 0:i.slug}/${i==null?void 0:i.id}`;return fetch(B).then($=>{if(!$.ok)throw new Error("Error al obtener la ronda");return $.json()})}),t=await Promise.all(j),h=t.flatMap(i=>i.games);return{broadcast:u,rounds:t,games:h}}catch(r){throw new Error("Error fetching broadcast and games: "+r.message)}},x=o=>{const r={};o.forEach(j=>{const[t,h]=j.players;if(t.name==="LIBRE"||h.name==="LIBRE"){t.name==="LIBRE"&&h.name!=="LIBRE"?(r[h.name]||(r[h.name]=0),r[h.name]+=1):h.name==="LIBRE"&&t.name!=="LIBRE"&&(r[t.name]||(r[t.name]=0),r[t.name]+=1);return}r[t.name]||(r[t.name]=0),r[h.name]||(r[h.name]=0),j.status==="1-0"?r[t.name]+=1:j.status==="0-1"?r[h.name]+=1:j.status==="½-½"&&(r[t.name]+=.5,r[h.name]+=.5)});const u=Object.entries(r).map(([j,t])=>({name:j,points:t}));return u.sort((j,t)=>t.points-j.points),u},{data:s,isLoading:c,error:f}=J({queryKey:["tournamentDetail",a],queryFn:()=>m(a),staleTime:1e3*60*20,cacheTime:1e3*60*30,refetchOnWindowFocus:!1});return console.log(s),d.useEffect(()=>{var o,r,u,j,t;if(s!==void 0&&(console.log((r=(o=s==null?void 0:s.games[0])==null?void 0:o.players)==null?void 0:r.length),((u=s==null?void 0:s.games)==null?void 0:u.length)>0&&((t=(j=s==null?void 0:s.games[0])==null?void 0:j.players)==null?void 0:t.length)>0)){let h=x(s==null?void 0:s.games);l(h)}},[s==null?void 0:s.games]),d.useEffect(()=>{},[a]),c?e.jsx(H,{msg:"Cargando torneo"}):f?e.jsxs("div",{children:["Error: ",f.message]}):e.jsx("div",{children:e.jsx("div",{children:s!==void 0?e.jsx(P,{className:"tournament-detail-container",children:e.jsxs(X,{className:"justify-content-center",children:[e.jsxs(K,{xs:12,lg:8,children:[e.jsxs(y,{className:"tournament-detail-card mb-4",children:[e.jsx(y.Header,{children:e.jsx("h2",{className:"mb-0",children:(g=(p=s.broadcast)==null?void 0:p.tour)==null?void 0:g.name})}),e.jsxs(y.Body,{children:[e.jsxs(y.Text,{children:[e.jsx(Q,{className:"me-2"}),e.jsxs("strong",{children:["Lugar: ",(N=s==null?void 0:s.broadcast.tour.info)==null?void 0:N.location]})," "]}),e.jsxs(y.Text,{children:[e.jsx(U,{className:"me-2"}),e.jsxs("strong",{children:["Fecha de inicio: ",new Date((S=(E=s==null?void 0:s.broadcast)==null?void 0:E.tour)==null?void 0:S.dates[0]).toLocaleDateString()]})," "]})]})]}),e.jsx(b,{className:"rounds-accordion mb-4",children:((T=s==null?void 0:s.rounds)==null?void 0:T.length)>0&&((O=s.rounds)==null?void 0:O.map((o,r)=>{var u,j,t,h;return e.jsxs(b.Item,{className:"rounds-item",eventKey:r.toString(),children:[e.jsx(b.Header,{className:"rounds-header",children:e.jsxs("h5",{className:"mb-0",children:[e.jsx(W,{className:"me-2"}),(u=o==null?void 0:o.round)==null?void 0:u.name]})}),e.jsx(b.Body,{children:((j=o==null?void 0:o.games)==null?void 0:j.length)>0&&((t=o==null?void 0:o.games)==null?void 0:t.map(i=>{var B,v;return e.jsx(y,{className:"match-card mb-2",children:e.jsx(y.Body,{children:(i==null?void 0:i.players)!==void 0&&e.jsxs("div",{className:"players-container",children:[e.jsx("span",{className:"player-name",children:(B=i==null?void 0:i.players[0])==null?void 0:B.name}),e.jsx(Y,{bg:"secondary",className:"result-badge",children:i==null?void 0:i.status}),e.jsx("span",{className:"player-name",children:(v=i==null?void 0:i.players[1])==null?void 0:v.name})]})})},i.id)}))})]},(h=o==null?void 0:o.round)==null?void 0:h.id)}))})]}),e.jsx(K,{xs:12,lg:4,children:e.jsxs(y,{className:"standings-card",children:[e.jsx(y.Header,{children:e.jsx("h3",{className:"mb-0",children:"Clasificación"})}),e.jsx(y.Body,{children:e.jsxs(Z,{striped:!0,bordered:!0,hover:!0,responsive:!0,className:"standings-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Jugador"}),e.jsx("th",{children:"Puntos"})]})}),e.jsx("tbody",{children:n.length>0&&(n==null?void 0:n.map(o=>e.jsxs("tr",{children:[e.jsx("td",{children:o.name}),e.jsx("td",{children:o.points})]},o.name)))})]})})]})})]})}):e.jsx(H,{msg:"Cargando torneo"})})})}export{oe as default};
